<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation - CICLABS</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script type="module" src="main.js"></script>
    <main>
        <div class="container">
            <h1>B-H Curve Simulation</h1>

            <div class="sim-grid">
                <!-- Left Panel: Controls & Circuit -->
                <div class="left-panel">
                    <div class="circuit-panel">
                        <h3>Experimental Setup</h3>
                        <!-- Detailed Circuit Diagram mimicking Virtual Labs -->
                        <div class="circuit-diagram"
                            style="background: white; border: 1px solid #ddd; margin-top: 1rem; border-radius: 4px; overflow: hidden;">

                            <img src="circuit.png" alt="Hysteresis experiment circuit" class="hysterisis-img">

                        </div>
                    </div>

                    <div class="controls-panel">
                        <h3>Experimental Controls</h3>

                        <div class="control-group">
                            <label for="materialSelect">Magnetic Material</label>
                            <select id="materialSelect">
                                <option value="soft_iron">Soft Iron (Low Coercivity)</option>
                                <option value="steel">Hard Steel (High Coercivity)</option>
                                <option value="ferrite">Ferrite</option>
                                <option value="cast_iron">Cast Iron</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <div style="display: flex; justify-content: space-between;">
                                <label for="resistanceRange">Rheostat Resistance (R)</label>
                                <span id="resistanceVal" style="color: var(--primary);">10 Ω</span>
                            </div>
                            <input type="range" id="resistanceRange" min="5" max="50" value="10">
                        </div>

                        <div class="control-group">
                            <div style="display: flex; justify-content: space-between;">
                                <label for="voltageRange">Input Voltage (V)</label>
                                <span id="voltageVal" style="color: var(--primary);">5 V</span>
                            </div>
                            <input type="range" id="voltageRange" min="1" max="20" value="5">
                        </div>

                        <div class="control-group">
                            <div style="display: flex; justify-content: space-between;">
                                <label for="frequencyRange">Frequency (f)</label>
                                <span id="frequencyVal" style="color: var(--primary);">50 Hz</span>
                            </div>
                            <input type="range" id="frequencyRange" min="10" max="100" value="50">
                        </div>

                        <div class="control-group"
                            style="display: flex; align-items: center; gap: 1rem; border-top: 1px solid #ddd; padding-top: 1rem;">
                            <label class="switch-label" style="margin: 0;">Supply:</label>
                            <button id="powerBtn" class="btn btn-error"
                                style="background: #ccc; border-bottom-color: #999; color: #333;">OFF</button>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: CRO & Data -->
                <div class="right-panel">
                    <div class="cro-container" style="text-align: center;">
                        <h3 style="margin-bottom: 0.5rem; color: #5d4037;">CRO Screen (X-Y Mode)</h3>
                        <div class="cro-display" id="croScreen">
                            <div class="cro-grid"></div>
                            <canvas id="hysteresisCanvas" width="400" height="400"></canvas>
                        </div>

                        <!-- CRO Controls -->
                        <div class="cro-controls"
                            style="background: #2a201b; padding: 10px; border-radius: 0 0 10px 10px; margin-top: -5px; color: #d7ccc8; display: flex; justify-content: space-around; font-size: 0.8rem; border: 1px solid #5d4037; border-top: none;">
                            <div style="text-align: center;">
                                <div style="margin-bottom: 2px;">Channel 1 (X)</div>
                                <input type="range" id="gainX" min="0.5" max="2" step="0.1" value="1"
                                    style="width: 60px;">
                            </div>
                            <div style="text-align: center;">
                                <div style="margin-bottom: 2px;">Channel 2 (Y)</div>
                                <input type="range" id="gainY" min="0.5" max="2" step="0.1" value="1"
                                    style="width: 60px;">
                            </div>
                            <!-- Cosmetic knobs -->
                            <div style="text-align: center;">
                                <div style="margin-bottom: 2px;">Focus</div>
                                <div
                                    style="width: 15px; height: 15px; background: #5d4037; border-radius: 50%; margin: 0 auto; border: 1px solid #8d6e63;">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 1rem; font-size: 0.9rem; color: #7F5836;">
                            X-Axis: Magnetizing Force (H) | Y-Axis: Flux Density (B)
                        </div>
                    </div>

                    <div class="readings-panel" style="margin-top: 2rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3>Observations</h3>
                            <button id="addReadingBtn" class="btn" disabled>+ Add Reading</button>
                        </div>

                        <div class="calc-box"
                            style="background: #fdfbf7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--border); display: flex; justify-content: space-around;">
                            <div>Area: <strong id="loopAreaDisplay" style="color: var(--accent);">0</strong></div>
                            <div>Work (H-Loss): <strong id="lossDisplay" style="color: var(--accent);">0</strong>
                                J/cycle</div>
                        </div>

                        <div style="overflow-x: auto;">
                            <table class="observation-table" id="obsTable">
                                <thead>
                                    <tr>
                                        <th>Material</th>
                                        <th>Freq (Hz)</th>
                                        <th>R (Ω)</th>
                                        <th>Area (mm²)</th>
                                        <th>Loss (J)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Rows added via JS -->
                                </tbody>
                            </table>
                        </div>
                        <button id="clearTableBtn" class="btn btn-secondary"
                            style="margin-top: 1rem; font-size: 0.8rem; width: 100%;">Reset Data</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module" src="simulation.js"></script>
</body>

</html>